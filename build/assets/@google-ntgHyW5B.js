/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class z{}function T(o,n){const e=/\{([^}]+)\}/g;return o.replace(e,(t,i)=>{if(Object.prototype.hasOwnProperty.call(n,i)){const l=n[i];return l!=null?String(l):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function s(o,n,e){for(let l=0;l<n.length-1;l++){const u=n[l];if(u.endsWith("[]")){const a=u.slice(0,-2);if(!(a in o))if(Array.isArray(e))o[a]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${u}`);if(Array.isArray(o[a])){const c=o[a];if(Array.isArray(e))for(let d=0;d<c.length;d++){const f=c[d];s(f,n.slice(l+1),e[d])}else for(const d of c)s(d,n.slice(l+1),e)}return}else if(u.endsWith("[0]")){const a=u.slice(0,-3);a in o||(o[a]=[{}]);const c=o[a];s(c[0],n.slice(l+1),e);return}(!o[u]||typeof o[u]!="object")&&(o[u]={}),o=o[u]}const t=n[n.length-1],i=o[t];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${t}`)}else o[t]=e}function r(o,n){try{if(n.length===1&&n[0]==="_self")return o;for(let e=0;e<n.length;e++){if(typeof o!="object"||o===null)return;const t=n[e];if(t.endsWith("[]")){const i=t.slice(0,-2);if(i in o){const l=o[i];return Array.isArray(l)?l.map(u=>r(u,n.slice(e+1))):void 0}else return}else o=o[t]}return o}catch(e){if(e instanceof TypeError)return;throw e}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function M(o,n){if(!n||typeof n!="string")throw new Error("model is required and must be a string");if(o.isVertexAI()){if(n.startsWith("publishers/")||n.startsWith("projects/")||n.startsWith("models/"))return n;if(n.indexOf("/")>=0){const e=n.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${n}`}else return n.startsWith("models/")||n.startsWith("tunedModels/")?n:`models/${n}`}function $e(o,n){const e=M(o,n);return e?e.startsWith("publishers/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}`:e.startsWith("models/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/publishers/google/${e}`:e:""}function j(o,n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function q(o,n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>j(o,e)):[j(o,n)]}function Ke(o){return o!=null&&typeof o=="object"&&"parts"in o&&Array.isArray(o.parts)}function ln(o){return o!=null&&typeof o=="object"&&"functionCall"in o}function X(o){return!(o==null||ln(o))}function Je(o){return o==null||Array.isArray(o)&&o.length===0?!1:o.every(X)}function R(o,n){if(n==null)throw new Error("ContentUnion is required");return Ke(n)?n:X(n)?{role:"user",parts:q(o,n)}:{role:"model",parts:q(o,n)}}function We(o,n){if(!n)return[];if(o.isVertexAI()&&Array.isArray(n))return n.flatMap(e=>{const t=R(o,e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]});if(o.isVertexAI()){const e=R(o,n);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(n)?n.map(e=>R(o,e)):[R(o,n)]}function k(o,n,e){e.length!==0&&(Je(e)?n.push({role:"user",parts:q(o,e)}):n.push({role:"model",parts:q(o,e)}),e.length=0)}function an(o,n,e,t){X(t)===Je(e)||(k(o,n,e),e.length=0),e.push(t)}function I(o,n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n))return[R(o,n)];const e=[],t=[];for(const i of n)if(Ke(i))k(o,e,t),e.push(i);else if(typeof i=="string"||typeof i=="object"&&!Array.isArray(i))an(o,e,t,i);else if(Array.isArray(i))k(o,e,t),e.push({role:"user",parts:q(o,i)});else throw new Error(`Unsupported content type: ${typeof i}`);return k(o,e,t),e}function ze(o,n){if(!o.isVertexAI()&&("title"in n&&delete n.title,"default"in n))throw new Error("Default value is not supported in the response schema for the Gemini API.");if("anyOf"in n){if(!o.isVertexAI())throw new Error("AnyOf is not supported in the response schema for the Gemini API.");if(n.anyOf!==void 0)for(const e of n.anyOf)ze(o,e)}}function Xe(o,n){return ze(o,n),n}function Qe(o,n){if(typeof n=="object"&&"voiceConfig"in n)return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Ze(o,n){return n}function V(o,n){if(!Array.isArray(n))throw new Error("tool is required and must be an array of Tools");return n}function un(o,n,e,t=1){const i=!n.startsWith(`${e}/`)&&n.split("/").length===t;return o.isVertexAI()?n.startsWith("projects/")?n:n.startsWith("locations/")?`projects/${o.getProject()}/${n}`:n.startsWith(`${e}/`)?`projects/${o.getProject()}/locations/${o.getLocation()}/${n}`:i?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}/${n}`:n:i?`${e}/${n}`:n}function D(o,n){if(typeof n!="string")throw new Error("name must be a string");return un(o,n,"cachedContents")}function be(o,n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function cn(o,n){if(typeof n!="string")throw new Error("fromName must be a string");return n.startsWith("files/")?n.split("files/")[1]:n}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Y;(function(o){o.PAGED_ITEM_BATCH_JOBS="batchJobs",o.PAGED_ITEM_MODELS="models",o.PAGED_ITEM_TUNING_JOBS="tuningJobs",o.PAGED_ITEM_FILES="files",o.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(Y||(Y={}));class je{constructor(n,e,t,i){this.pageInternal=[],this.requestInternal=e,this.init(n,t,i)}init(n,e,t){var i,l;this.nameInternal=n,this.pageInternal=e[this.nameInternal]||[],this.idxInternal=0;let u={config:{}};t?typeof t=="object"?u=Object.assign({},t):u=t:u={config:{}},u.config&&(u.config.pageToken=e.nextPageToken),this.paramsInternal=u,this.pageInternalSize=(l=(i=u.config)===null||i===void 0?void 0:i.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(n){this.init(this.nameInternal,n,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(n){return this.pageInternal[n]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const n=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:n,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const n=await this.requestInternal(this.params);return this.initNextPage(n),this.page}hasNextPage(){var n;return((n=this.params.config)===null||n===void 0?void 0:n.pageToken)!==void 0}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ee;(function(o){o.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(ee||(ee={}));var ne;(function(o){o.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",o.PYTHON="PYTHON"})(ne||(ne={}));var te;(function(o){o.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT"})(te||(te={}));var oe;(function(o){o.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(oe||(oe={}));var ie;(function(o){o.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",o.SEVERITY="SEVERITY",o.PROBABILITY="PROBABILITY"})(ie||(ie={}));var re;(function(o){o.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF"})(re||(re={}));var se;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(se||(se={}));var le;(function(o){o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL"})(le||(le={}));var ae;(function(o){o.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH"})(ae||(ae={}));var ue;(function(o){o.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",o.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",o.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",o.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",o.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(ue||(ue={}));var ce;(function(o){o.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",o.SAFETY="SAFETY",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(ce||(ce={}));var fe;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.ACTIVE="ACTIVE",o.ERROR="ERROR"})(fe||(fe={}));var de;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(de||(de={}));var pe;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE"})(pe||(pe={}));var he;(function(o){o.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",o.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",o.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",o.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(he||(he={}));var me;(function(o){o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE"})(me||(me={}));var ge;(function(o){o.DONT_ALLOW="DONT_ALLOW",o.ALLOW_ADULT="ALLOW_ADULT",o.ALLOW_ALL="ALLOW_ALL"})(ge||(ge={}));var Ce;(function(o){o.auto="auto",o.en="en",o.ja="ja",o.ko="ko",o.hi="hi"})(Ce||(Ce={}));var ye;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.PROCESSING="PROCESSING",o.ACTIVE="ACTIVE",o.FAILED="FAILED"})(ye||(ye={}));var Ee;(function(o){o.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",o.UPLOADED="UPLOADED",o.GENERATED="GENERATED"})(Ee||(Ee={}));var Te;(function(o){o.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",o.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",o.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",o.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",o.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Te||(Te={}));var _e;(function(o){o.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",o.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",o.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",o.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(_e||(_e={}));var ve;(function(o){o.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",o.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",o.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",o.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(ve||(ve={}));var Ie;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.AUDIO="AUDIO"})(Ie||(Ie={}));class O{get text(){var n,e,t,i,l,u,a,c;if(((i=(t=(e=(n=this.candidates)===null||n===void 0?void 0:n[0])===null||e===void 0?void 0:e.content)===null||t===void 0?void 0:t.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",f=!1;const p=[];for(const m of(c=(a=(u=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content)===null||a===void 0?void 0:a.parts)!==null&&c!==void 0?c:[]){for(const[h,g]of Object.entries(m))h!=="text"&&h!=="thought"&&(g!==null||g!==void 0)&&p.push(h);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;f=!0,d+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?d:void 0}get functionCalls(){var n,e,t,i,l,u,a,c;if(((i=(t=(e=(n=this.candidates)===null||n===void 0?void 0:n[0])===null||e===void 0?void 0:e.content)===null||t===void 0?void 0:t.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(a=(u=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var n,e,t,i,l,u,a,c,d;if(((i=(t=(e=(n=this.candidates)===null||n===void 0?void 0:n[0])===null||e===void 0?void 0:e.content)===null||t===void 0?void 0:t.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(c=(a=(u=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(d=f==null?void 0:f[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var n,e,t,i,l,u,a,c,d;if(((i=(t=(e=(n=this.candidates)===null||n===void 0?void 0:n[0])===null||e===void 0?void 0:e.content)===null||t===void 0?void 0:t.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(c=(a=(u=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(d=f==null?void 0:f[0])===null||d===void 0?void 0:d.output}}class Ae{}class Se{}class Me{}class Re{}class Pe{}class xe{}class we{}class en{constructor(n){const e={};for(const t of n.headers.entries())e[t[0]]=t[1];this.headers=e,this.responseInternal=n}json(){return this.responseInternal.json()}}class Ne{}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fn extends z{constructor(n){super(),this.apiClient=n,this.list=async(e={})=>new je(Y.PAGED_ITEM_CACHED_CONTENTS,t=>this.listInternal(t),await this.listInternal(e),e)}async create(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Dn(this.apiClient,n);return l=T("cachedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>B(this.apiClient,c))}else{const a=Nn(this.apiClient,n);return l=T("cachedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>H(this.apiClient,c))}}async get(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Fn(this.apiClient,n);return l=T("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>B(this.apiClient,c))}else{const a=Ln(this.apiClient,n);return l=T("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>H(this.apiClient,c))}}async delete(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Un(this.apiClient,n);return l=T("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Jn(this.apiClient),f=new Pe;return Object.assign(f,d),f})}else{const a=Vn(this.apiClient,n);return l=T("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Kn(this.apiClient),f=new Pe;return Object.assign(f,d),f})}}async update(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=kn(this.apiClient,n);return l=T("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"PATCH",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>B(this.apiClient,c))}else{const a=On(this.apiClient,n);return l=T("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"PATCH",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>H(this.apiClient,c))}}async listInternal(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=$n(this.apiClient,n);return l=T("cachedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=zn(this.apiClient,c),f=new xe;return Object.assign(f,d),f})}else{const a=Yn(this.apiClient,n);return l=T("cachedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Wn(this.apiClient,c),f=new xe;return Object.assign(f,d),f})}}}function dn(o,n){const e={};if(r(n,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const t=r(n,["thought"]);t!=null&&s(e,["thought"],t);const i=r(n,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const l=r(n,["executableCode"]);l!=null&&s(e,["executableCode"],l);const u=r(n,["fileData"]);u!=null&&s(e,["fileData"],u);const a=r(n,["functionCall"]);a!=null&&s(e,["functionCall"],a);const c=r(n,["functionResponse"]);c!=null&&s(e,["functionResponse"],c);const d=r(n,["inlineData"]);d!=null&&s(e,["inlineData"],d);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function pn(o,n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],t);const i=r(n,["thought"]);i!=null&&s(e,["thought"],i);const l=r(n,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],a);const c=r(n,["functionCall"]);c!=null&&s(e,["functionCall"],c);const d=r(n,["functionResponse"]);d!=null&&s(e,["functionResponse"],d);const f=r(n,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=r(n,["text"]);return p!=null&&s(e,["text"],p),e}function De(o,n){const e={},t=r(n,["parts"]);t!=null&&(Array.isArray(t)?s(e,["parts"],t.map(l=>dn(o,l))):s(e,["parts"],t));const i=r(n,["role"]);return i!=null&&s(e,["role"],i),e}function Le(o,n){const e={},t=r(n,["parts"]);t!=null&&(Array.isArray(t)?s(e,["parts"],t.map(l=>pn(o,l))):s(e,["parts"],t));const i=r(n,["role"]);return i!=null&&s(e,["role"],i),e}function hn(o,n){const e={},t=r(n,["example"]);t!=null&&s(e,["example"],t);const i=r(n,["pattern"]);i!=null&&s(e,["pattern"],i);const l=r(n,["minimum"]);l!=null&&s(e,["minimum"],l);const u=r(n,["default"]);u!=null&&s(e,["default"],u);const a=r(n,["anyOf"]);a!=null&&s(e,["anyOf"],a);const c=r(n,["maxLength"]);c!=null&&s(e,["maxLength"],c);const d=r(n,["title"]);d!=null&&s(e,["title"],d);const f=r(n,["minLength"]);f!=null&&s(e,["minLength"],f);const p=r(n,["minProperties"]);p!=null&&s(e,["minProperties"],p);const m=r(n,["maximum"]);m!=null&&s(e,["maximum"],m);const h=r(n,["maxProperties"]);h!=null&&s(e,["maxProperties"],h);const g=r(n,["description"]);g!=null&&s(e,["description"],g);const C=r(n,["enum"]);C!=null&&s(e,["enum"],C);const y=r(n,["format"]);y!=null&&s(e,["format"],y);const _=r(n,["items"]);_!=null&&s(e,["items"],_);const E=r(n,["maxItems"]);E!=null&&s(e,["maxItems"],E);const v=r(n,["minItems"]);v!=null&&s(e,["minItems"],v);const S=r(n,["nullable"]);S!=null&&s(e,["nullable"],S);const P=r(n,["properties"]);P!=null&&s(e,["properties"],P);const x=r(n,["propertyOrdering"]);x!=null&&s(e,["propertyOrdering"],x);const w=r(n,["required"]);w!=null&&s(e,["required"],w);const N=r(n,["type"]);return N!=null&&s(e,["type"],N),e}function mn(o,n){const e={};if(r(n,["response"])!==void 0)throw new Error("response parameter is not supported in Gemini API.");const t=r(n,["description"]);t!=null&&s(e,["description"],t);const i=r(n,["name"]);i!=null&&s(e,["name"],i);const l=r(n,["parameters"]);return l!=null&&s(e,["parameters"],l),e}function gn(o,n){const e={},t=r(n,["response"]);t!=null&&s(e,["response"],hn(o,t));const i=r(n,["description"]);i!=null&&s(e,["description"],i);const l=r(n,["name"]);l!=null&&s(e,["name"],l);const u=r(n,["parameters"]);return u!=null&&s(e,["parameters"],u),e}function Cn(o,n){return{}}function yn(o,n){return{}}function En(o,n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Tn(o,n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function _n(o,n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],En(o,t)),e}function vn(o,n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],Tn(o,t)),e}function In(o,n){const e={},t=r(n,["functionDeclarations"]);if(t!=null&&(Array.isArray(t)?s(e,["functionDeclarations"],t.map(a=>mn(o,a))):s(e,["functionDeclarations"],t)),r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(n,["googleSearch"])!=null&&s(e,["googleSearch"],Cn());const l=r(n,["googleSearchRetrieval"]);l!=null&&s(e,["googleSearchRetrieval"],_n(o,l));const u=r(n,["codeExecution"]);return u!=null&&s(e,["codeExecution"],u),e}function An(o,n){const e={},t=r(n,["functionDeclarations"]);t!=null&&(Array.isArray(t)?s(e,["functionDeclarations"],t.map(c=>gn(o,c))):s(e,["functionDeclarations"],t));const i=r(n,["retrieval"]);i!=null&&s(e,["retrieval"],i),r(n,["googleSearch"])!=null&&s(e,["googleSearch"],yn());const u=r(n,["googleSearchRetrieval"]);u!=null&&s(e,["googleSearchRetrieval"],vn(o,u));const a=r(n,["codeExecution"]);return a!=null&&s(e,["codeExecution"],a),e}function Sn(o,n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const i=r(n,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Mn(o,n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const i=r(n,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Rn(o,n){const e={},t=r(n,["functionCallingConfig"]);return t!=null&&s(e,["functionCallingConfig"],Sn(o,t)),e}function Pn(o,n){const e={},t=r(n,["functionCallingConfig"]);return t!=null&&s(e,["functionCallingConfig"],Mn(o,t)),e}function xn(o,n,e){const t={},i=r(n,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(n,["expireTime"]);e!==void 0&&l!=null&&s(e,["expireTime"],l);const u=r(n,["displayName"]);e!==void 0&&u!=null&&s(e,["displayName"],u);const a=r(n,["contents"]);e!==void 0&&a!=null&&(Array.isArray(a)?s(e,["contents"],I(o,I(o,a).map(p=>De(o,p)))):s(e,["contents"],I(o,a)));const c=r(n,["systemInstruction"]);e!==void 0&&c!=null&&s(e,["systemInstruction"],De(o,R(o,c)));const d=r(n,["tools"]);e!==void 0&&d!=null&&(Array.isArray(d)?s(e,["tools"],d.map(p=>In(o,p))):s(e,["tools"],d));const f=r(n,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],Rn(o,f)),t}function wn(o,n,e){const t={},i=r(n,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(n,["expireTime"]);e!==void 0&&l!=null&&s(e,["expireTime"],l);const u=r(n,["displayName"]);e!==void 0&&u!=null&&s(e,["displayName"],u);const a=r(n,["contents"]);e!==void 0&&a!=null&&(Array.isArray(a)?s(e,["contents"],I(o,I(o,a).map(p=>Le(o,p)))):s(e,["contents"],I(o,a)));const c=r(n,["systemInstruction"]);e!==void 0&&c!=null&&s(e,["systemInstruction"],Le(o,R(o,c)));const d=r(n,["tools"]);e!==void 0&&d!=null&&(Array.isArray(d)?s(e,["tools"],d.map(p=>An(o,p))):s(e,["tools"],d));const f=r(n,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],Pn(o,f)),t}function Nn(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["model"],$e(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],xn(o,i,e)),e}function Dn(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["model"],$e(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],wn(o,i,e)),e}function Ln(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","name"],D(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],i),e}function Fn(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","name"],D(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],i),e}function Vn(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","name"],D(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],i),e}function Un(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","name"],D(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],i),e}function qn(o,n,e){const t={},i=r(n,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(n,["expireTime"]);return e!==void 0&&l!=null&&s(e,["expireTime"],l),t}function Gn(o,n,e){const t={},i=r(n,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(n,["expireTime"]);return e!==void 0&&l!=null&&s(e,["expireTime"],l),t}function On(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","name"],D(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],qn(o,i,e)),e}function kn(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","name"],D(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],Gn(o,i,e)),e}function Hn(o,n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(n,["pageToken"]);return e!==void 0&&l!=null&&s(e,["_query","pageToken"],l),t}function Bn(o,n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(n,["pageToken"]);return e!==void 0&&l!=null&&s(e,["_query","pageToken"],l),t}function Yn(o,n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],Hn(o,t,e)),e}function $n(o,n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],Bn(o,t,e)),e}function H(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const i=r(n,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(n,["model"]);l!=null&&s(e,["model"],l);const u=r(n,["createTime"]);u!=null&&s(e,["createTime"],u);const a=r(n,["updateTime"]);a!=null&&s(e,["updateTime"],a);const c=r(n,["expireTime"]);c!=null&&s(e,["expireTime"],c);const d=r(n,["usageMetadata"]);return d!=null&&s(e,["usageMetadata"],d),e}function B(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const i=r(n,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(n,["model"]);l!=null&&s(e,["model"],l);const u=r(n,["createTime"]);u!=null&&s(e,["createTime"],u);const a=r(n,["updateTime"]);a!=null&&s(e,["updateTime"],a);const c=r(n,["expireTime"]);c!=null&&s(e,["expireTime"],c);const d=r(n,["usageMetadata"]);return d!=null&&s(e,["usageMetadata"],d),e}function Kn(o,n){return{}}function Jn(o,n){return{}}function Wn(o,n){const e={},t=r(n,["nextPageToken"]);t!=null&&s(e,["nextPageToken"],t);const i=r(n,["cachedContents"]);return i!=null&&(Array.isArray(i)?s(e,["cachedContents"],i.map(l=>H(o,l))):s(e,["cachedContents"],i)),e}function zn(o,n){const e={},t=r(n,["nextPageToken"]);t!=null&&s(e,["nextPageToken"],t);const i=r(n,["cachedContents"]);return i!=null&&(Array.isArray(i)?s(e,["cachedContents"],i.map(l=>B(o,l))):s(e,["cachedContents"],i)),e}function Fe(o){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&o[n],t=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&t>=o.length&&(o=void 0),{value:o&&o[t++],done:!o}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(o){return this instanceof A?(this.v=o,this):new A(o)}function $(o,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e.apply(o,n||[]),i,l=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",u),i[Symbol.asyncIterator]=function(){return this},i;function u(h){return function(g){return Promise.resolve(g).then(h,p)}}function a(h,g){t[h]&&(i[h]=function(C){return new Promise(function(y,_){l.push([h,C,y,_])>1||c(h,C)})},g&&(i[h]=g(i[h])))}function c(h,g){try{d(t[h](g))}catch(C){m(l[0][3],C)}}function d(h){h.value instanceof A?Promise.resolve(h.value.v).then(f,p):m(l[0][2],h)}function f(h){c("next",h)}function p(h){c("throw",h)}function m(h,g){h(g),l.shift(),l.length&&c(l[0][0],l[0][1])}}function J(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=o[Symbol.asyncIterator],e;return n?n.call(o):(o=typeof Fe=="function"?Fe(o):o[Symbol.iterator](),e={},t("next"),t("throw"),t("return"),e[Symbol.asyncIterator]=function(){return this},e);function t(l){e[l]=o[l]&&function(u){return new Promise(function(a,c){u=o[l](u),i(a,c,u.done,u.value)})}}function i(l,u,a,c){Promise.resolve(c).then(function(d){l({value:d,done:a})},u)}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xn(o){var n;if(o.candidates==null||o.candidates.length===0)return!1;const e=(n=o.candidates[0])===null||n===void 0?void 0:n.content;return e===void 0?!1:nn(e)}function nn(o){if(o.parts===void 0||o.parts.length===0)return!1;for(const n of o.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}function Qn(o){if(o.length!==0){if(o[0].role!=="user")throw new Error("History must start with a user turn.");for(const n of o)if(n.role!=="user"&&n.role!=="model")throw new Error(`Role must be user or model, but got ${n.role}.`)}}function Zn(o){if(o===void 0||o.length===0)return[];const n=[],e=o.length;let t=0,i=o[0];for(;t<e;)if(o[t].role==="user")i=o[t],t++;else{const l=[];let u=!0;for(;t<e&&o[t].role==="model";)l.push(o[t]),u&&!nn(o[t])&&(u=!1),t++;u&&(n.push(i),n.push(...l))}return n}class bn{constructor(n,e){this.modelsModule=n,this.apiClient=e}create(n){return new jn(this.apiClient,this.modelsModule,n.model,n.config,n.history)}}class jn{constructor(n,e,t,i={},l=[]){this.apiClient=n,this.modelsModule=e,this.model=t,this.config=i,this.history=l,this.sendPromise=Promise.resolve(),Qn(l)}async sendMessage(n){var e;await this.sendPromise;const t=R(this.apiClient,n.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(t),config:(e=n.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var l,u;const c=(u=(l=(await i).candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content,d=c?[c]:[];this.recordHistory(t,d)})(),await this.sendPromise,i}async sendMessageStream(n){var e;await this.sendPromise;const t=R(this.apiClient,n.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(t),config:(e=n.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{});const l=await i;return this.processStreamResponse(l,t)}getHistory(n=!1){return n?Zn(this.history):this.history}processStreamResponse(n,e){var t,i;return $(this,arguments,function*(){var u,a,c,d;const f=[];try{for(var p=!0,m=J(n),h;h=yield A(m.next()),u=h.done,!u;p=!0){d=h.value,p=!1;const g=d;if(Xn(g)){const C=(i=(t=g.candidates)===null||t===void 0?void 0:t[0])===null||i===void 0?void 0:i.content;C!==void 0&&f.push(C)}yield yield A(g)}}catch(g){a={error:g}}finally{try{!p&&!u&&(c=m.return)&&(yield A(c.call(m)))}finally{if(a)throw a.error}}this.recordHistory(e,f)})}recordHistory(n,e){let t=[];e.length>0&&e.every(i=>i.role==="model")?t=e:t.push({role:"model",parts:[]}),this.history.push(n),this.history.push(...t)}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class et extends z{constructor(n){super(),this.apiClient=n,this.generateContent=async e=>await this.generateContentInternal(e),this.generateContentStream=async e=>await this.generateContentStreamInternal(e)}async generateContentInternal(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Ue(this.apiClient,n);return l=T("{model}:generateContent",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Ge(this.apiClient,c),f=new O;return Object.assign(f,d),f})}else{const a=Ve(this.apiClient,n);return l=T("{model}:generateContent",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>{const d=qe(this.apiClient,c),f=new O;return Object.assign(f,d),f})}}async generateContentStreamInternal(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Ue(this.apiClient,n);l=T("{model}:streamGenerateContent?alt=sse",a._url),u=a._query,delete a.config,delete a._url,delete a._query;const c=this.apiClient;return i=c.requestStream({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}),i.then(function(d){return $(this,arguments,function*(){var f,p,m,h;try{for(var g=!0,C=J(d),y;y=yield A(C.next()),f=y.done,!f;g=!0){h=y.value,g=!1;const E=Ge(c,h),v=new O;Object.assign(v,E),yield yield A(v)}}catch(_){p={error:_}}finally{try{!g&&!f&&(m=C.return)&&(yield A(m.call(C)))}finally{if(p)throw p.error}}})})}else{const a=Ve(this.apiClient,n);l=T("{model}:streamGenerateContent?alt=sse",a._url),u=a._query,delete a.config,delete a._url,delete a._query;const c=this.apiClient;return i=c.requestStream({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}),i.then(function(d){return $(this,arguments,function*(){var f,p,m,h;try{for(var g=!0,C=J(d),y;y=yield A(C.next()),f=y.done,!f;g=!0){h=y.value,g=!1;const E=qe(c,h),v=new O;Object.assign(v,E),yield yield A(v)}}catch(_){p={error:_}}finally{try{!g&&!f&&(m=C.return)&&(yield A(m.call(C)))}finally{if(p)throw p.error}}})})}}async embedContent(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Nt(this.apiClient,n);return l=T("{model}:predict",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=eo(this.apiClient,c),f=new Ae;return Object.assign(f,d),f})}else{const a=wt(this.apiClient,n);return l=T("{model}:batchEmbedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>{const d=jt(this.apiClient,c),f=new Ae;return Object.assign(f,d),f})}}async generateImages(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Vt(this.apiClient,n);return l=T("{model}:predict",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=so(this.apiClient,c),f=new Se;return Object.assign(f,d),f})}else{const a=Ft(this.apiClient,n);return l=T("{model}:predict",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>{const d=ro(this.apiClient,c),f=new Se;return Object.assign(f,d),f})}}async countTokens(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Ot(this.apiClient,n);return l=T("{model}:countTokens",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=ao(this.apiClient,c),f=new Me;return Object.assign(f,d),f})}else{const a=Gt(this.apiClient,n);return l=T("{model}:countTokens",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>{const d=lo(this.apiClient,c),f=new Me;return Object.assign(f,d),f})}}async computeTokens(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Ht(this.apiClient,n);return l=T("{model}:computeTokens",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=co(this.apiClient,c),f=new Re;return Object.assign(f,d),f})}else{const a=kt(this.apiClient,n);return l=T("None",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>{const d=uo(this.apiClient,c),f=new Re;return Object.assign(f,d),f})}}}function nt(o,n){const e={};if(r(n,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const t=r(n,["thought"]);t!=null&&s(e,["thought"],t);const i=r(n,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const l=r(n,["executableCode"]);l!=null&&s(e,["executableCode"],l);const u=r(n,["fileData"]);u!=null&&s(e,["fileData"],u);const a=r(n,["functionCall"]);a!=null&&s(e,["functionCall"],a);const c=r(n,["functionResponse"]);c!=null&&s(e,["functionResponse"],c);const d=r(n,["inlineData"]);d!=null&&s(e,["inlineData"],d);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function tt(o,n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],t);const i=r(n,["thought"]);i!=null&&s(e,["thought"],i);const l=r(n,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],a);const c=r(n,["functionCall"]);c!=null&&s(e,["functionCall"],c);const d=r(n,["functionResponse"]);d!=null&&s(e,["functionResponse"],d);const f=r(n,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=r(n,["text"]);return p!=null&&s(e,["text"],p),e}function G(o,n){const e={},t=r(n,["parts"]);t!=null&&(Array.isArray(t)?s(e,["parts"],t.map(l=>nt(o,l))):s(e,["parts"],t));const i=r(n,["role"]);return i!=null&&s(e,["role"],i),e}function L(o,n){const e={},t=r(n,["parts"]);t!=null&&(Array.isArray(t)?s(e,["parts"],t.map(l=>tt(o,l))):s(e,["parts"],t));const i=r(n,["role"]);return i!=null&&s(e,["role"],i),e}function ot(o,n){const e={};if(r(n,["example"])!==void 0)throw new Error("example parameter is not supported in Gemini API.");if(r(n,["pattern"])!==void 0)throw new Error("pattern parameter is not supported in Gemini API.");if(r(n,["minimum"])!==void 0)throw new Error("minimum parameter is not supported in Gemini API.");if(r(n,["default"])!==void 0)throw new Error("default parameter is not supported in Gemini API.");if(r(n,["anyOf"])!==void 0)throw new Error("anyOf parameter is not supported in Gemini API.");if(r(n,["maxLength"])!==void 0)throw new Error("maxLength parameter is not supported in Gemini API.");if(r(n,["title"])!==void 0)throw new Error("title parameter is not supported in Gemini API.");if(r(n,["minLength"])!==void 0)throw new Error("minLength parameter is not supported in Gemini API.");if(r(n,["minProperties"])!==void 0)throw new Error("minProperties parameter is not supported in Gemini API.");if(r(n,["maximum"])!==void 0)throw new Error("maximum parameter is not supported in Gemini API.");if(r(n,["maxProperties"])!==void 0)throw new Error("maxProperties parameter is not supported in Gemini API.");const t=r(n,["description"]);t!=null&&s(e,["description"],t);const i=r(n,["enum"]);i!=null&&s(e,["enum"],i);const l=r(n,["format"]);l!=null&&s(e,["format"],l);const u=r(n,["items"]);u!=null&&s(e,["items"],u);const a=r(n,["maxItems"]);a!=null&&s(e,["maxItems"],a);const c=r(n,["minItems"]);c!=null&&s(e,["minItems"],c);const d=r(n,["nullable"]);d!=null&&s(e,["nullable"],d);const f=r(n,["properties"]);f!=null&&s(e,["properties"],f);const p=r(n,["propertyOrdering"]);p!=null&&s(e,["propertyOrdering"],p);const m=r(n,["required"]);m!=null&&s(e,["required"],m);const h=r(n,["type"]);return h!=null&&s(e,["type"],h),e}function tn(o,n){const e={},t=r(n,["example"]);t!=null&&s(e,["example"],t);const i=r(n,["pattern"]);i!=null&&s(e,["pattern"],i);const l=r(n,["minimum"]);l!=null&&s(e,["minimum"],l);const u=r(n,["default"]);u!=null&&s(e,["default"],u);const a=r(n,["anyOf"]);a!=null&&s(e,["anyOf"],a);const c=r(n,["maxLength"]);c!=null&&s(e,["maxLength"],c);const d=r(n,["title"]);d!=null&&s(e,["title"],d);const f=r(n,["minLength"]);f!=null&&s(e,["minLength"],f);const p=r(n,["minProperties"]);p!=null&&s(e,["minProperties"],p);const m=r(n,["maximum"]);m!=null&&s(e,["maximum"],m);const h=r(n,["maxProperties"]);h!=null&&s(e,["maxProperties"],h);const g=r(n,["description"]);g!=null&&s(e,["description"],g);const C=r(n,["enum"]);C!=null&&s(e,["enum"],C);const y=r(n,["format"]);y!=null&&s(e,["format"],y);const _=r(n,["items"]);_!=null&&s(e,["items"],_);const E=r(n,["maxItems"]);E!=null&&s(e,["maxItems"],E);const v=r(n,["minItems"]);v!=null&&s(e,["minItems"],v);const S=r(n,["nullable"]);S!=null&&s(e,["nullable"],S);const P=r(n,["properties"]);P!=null&&s(e,["properties"],P);const x=r(n,["propertyOrdering"]);x!=null&&s(e,["propertyOrdering"],x);const w=r(n,["required"]);w!=null&&s(e,["required"],w);const N=r(n,["type"]);return N!=null&&s(e,["type"],N),e}function it(o,n){const e={};if(r(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=r(n,["category"]);t!=null&&s(e,["category"],t);const i=r(n,["threshold"]);return i!=null&&s(e,["threshold"],i),e}function rt(o,n){const e={},t=r(n,["method"]);t!=null&&s(e,["method"],t);const i=r(n,["category"]);i!=null&&s(e,["category"],i);const l=r(n,["threshold"]);return l!=null&&s(e,["threshold"],l),e}function st(o,n){const e={};if(r(n,["response"])!==void 0)throw new Error("response parameter is not supported in Gemini API.");const t=r(n,["description"]);t!=null&&s(e,["description"],t);const i=r(n,["name"]);i!=null&&s(e,["name"],i);const l=r(n,["parameters"]);return l!=null&&s(e,["parameters"],l),e}function lt(o,n){const e={},t=r(n,["response"]);t!=null&&s(e,["response"],tn(o,t));const i=r(n,["description"]);i!=null&&s(e,["description"],i);const l=r(n,["name"]);l!=null&&s(e,["name"],l);const u=r(n,["parameters"]);return u!=null&&s(e,["parameters"],u),e}function at(o,n){return{}}function ut(o,n){return{}}function ct(o,n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function ft(o,n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const i=r(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function dt(o,n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],ct(o,t)),e}function pt(o,n){const e={},t=r(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],ft(o,t)),e}function on(o,n){const e={},t=r(n,["functionDeclarations"]);if(t!=null&&(Array.isArray(t)?s(e,["functionDeclarations"],t.map(a=>st(o,a))):s(e,["functionDeclarations"],t)),r(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(n,["googleSearch"])!=null&&s(e,["googleSearch"],at());const l=r(n,["googleSearchRetrieval"]);l!=null&&s(e,["googleSearchRetrieval"],dt(o,l));const u=r(n,["codeExecution"]);return u!=null&&s(e,["codeExecution"],u),e}function Q(o,n){const e={},t=r(n,["functionDeclarations"]);t!=null&&(Array.isArray(t)?s(e,["functionDeclarations"],t.map(c=>lt(o,c))):s(e,["functionDeclarations"],t));const i=r(n,["retrieval"]);i!=null&&s(e,["retrieval"],i),r(n,["googleSearch"])!=null&&s(e,["googleSearch"],ut());const u=r(n,["googleSearchRetrieval"]);u!=null&&s(e,["googleSearchRetrieval"],pt(o,u));const a=r(n,["codeExecution"]);return a!=null&&s(e,["codeExecution"],a),e}function ht(o,n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const i=r(n,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function mt(o,n){const e={},t=r(n,["mode"]);t!=null&&s(e,["mode"],t);const i=r(n,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function gt(o,n){const e={},t=r(n,["functionCallingConfig"]);return t!=null&&s(e,["functionCallingConfig"],ht(o,t)),e}function Ct(o,n){const e={},t=r(n,["functionCallingConfig"]);return t!=null&&s(e,["functionCallingConfig"],mt(o,t)),e}function yt(o,n){const e={},t=r(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function Et(o,n){const e={},t=r(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function Tt(o,n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],yt(o,t)),e}function _t(o,n){const e={},t=r(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],Et(o,t)),e}function vt(o,n){const e={},t=r(n,["voiceConfig"]);return t!=null&&s(e,["voiceConfig"],Tt(o,t)),e}function It(o,n){const e={},t=r(n,["voiceConfig"]);return t!=null&&s(e,["voiceConfig"],_t(o,t)),e}function At(o,n){const e={},t=r(n,["includeThoughts"]);return t!=null&&s(e,["includeThoughts"],t),e}function St(o,n){const e={},t=r(n,["includeThoughts"]);return t!=null&&s(e,["includeThoughts"],t),e}function Mt(o,n,e){const t={},i=r(n,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],G(o,R(o,i)));const l=r(n,["temperature"]);l!=null&&s(t,["temperature"],l);const u=r(n,["topP"]);u!=null&&s(t,["topP"],u);const a=r(n,["topK"]);a!=null&&s(t,["topK"],a);const c=r(n,["candidateCount"]);c!=null&&s(t,["candidateCount"],c);const d=r(n,["maxOutputTokens"]);d!=null&&s(t,["maxOutputTokens"],d);const f=r(n,["stopSequences"]);f!=null&&s(t,["stopSequences"],f);const p=r(n,["responseLogprobs"]);p!=null&&s(t,["responseLogprobs"],p);const m=r(n,["logprobs"]);m!=null&&s(t,["logprobs"],m);const h=r(n,["presencePenalty"]);h!=null&&s(t,["presencePenalty"],h);const g=r(n,["frequencyPenalty"]);g!=null&&s(t,["frequencyPenalty"],g);const C=r(n,["seed"]);C!=null&&s(t,["seed"],C);const y=r(n,["responseMimeType"]);y!=null&&s(t,["responseMimeType"],y);const _=r(n,["responseSchema"]);if(_!=null&&s(t,["responseSchema"],ot(o,Xe(o,_))),r(n,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");const E=r(n,["safetySettings"]);e!==void 0&&E!=null&&(Array.isArray(E)?s(e,["safetySettings"],E.map(F=>it(o,F))):s(e,["safetySettings"],E));const v=r(n,["tools"]);e!==void 0&&v!=null&&(Array.isArray(v)?s(e,["tools"],V(o,V(o,v).map(F=>on(o,Ze(o,F))))):s(e,["tools"],V(o,v)));const S=r(n,["toolConfig"]);if(e!==void 0&&S!=null&&s(e,["toolConfig"],gt(o,S)),r(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=r(n,["cachedContent"]);e!==void 0&&P!=null&&s(e,["cachedContent"],D(o,P));const x=r(n,["responseModalities"]);x!=null&&s(t,["responseModalities"],x);const w=r(n,["mediaResolution"]);w!=null&&s(t,["mediaResolution"],w);const N=r(n,["speechConfig"]);if(N!=null&&s(t,["speechConfig"],vt(o,Qe(o,N))),r(n,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const U=r(n,["thinkingConfig"]);return U!=null&&s(t,["thinkingConfig"],At(o,U)),t}function Rt(o,n,e){const t={},i=r(n,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],L(o,R(o,i)));const l=r(n,["temperature"]);l!=null&&s(t,["temperature"],l);const u=r(n,["topP"]);u!=null&&s(t,["topP"],u);const a=r(n,["topK"]);a!=null&&s(t,["topK"],a);const c=r(n,["candidateCount"]);c!=null&&s(t,["candidateCount"],c);const d=r(n,["maxOutputTokens"]);d!=null&&s(t,["maxOutputTokens"],d);const f=r(n,["stopSequences"]);f!=null&&s(t,["stopSequences"],f);const p=r(n,["responseLogprobs"]);p!=null&&s(t,["responseLogprobs"],p);const m=r(n,["logprobs"]);m!=null&&s(t,["logprobs"],m);const h=r(n,["presencePenalty"]);h!=null&&s(t,["presencePenalty"],h);const g=r(n,["frequencyPenalty"]);g!=null&&s(t,["frequencyPenalty"],g);const C=r(n,["seed"]);C!=null&&s(t,["seed"],C);const y=r(n,["responseMimeType"]);y!=null&&s(t,["responseMimeType"],y);const _=r(n,["responseSchema"]);_!=null&&s(t,["responseSchema"],tn(o,Xe(o,_)));const E=r(n,["routingConfig"]);E!=null&&s(t,["routingConfig"],E);const v=r(n,["safetySettings"]);e!==void 0&&v!=null&&(Array.isArray(v)?s(e,["safetySettings"],v.map(K=>rt(o,K))):s(e,["safetySettings"],v));const S=r(n,["tools"]);e!==void 0&&S!=null&&(Array.isArray(S)?s(e,["tools"],V(o,V(o,S).map(K=>Q(o,Ze(o,K))))):s(e,["tools"],V(o,S)));const P=r(n,["toolConfig"]);e!==void 0&&P!=null&&s(e,["toolConfig"],Ct(o,P));const x=r(n,["labels"]);e!==void 0&&x!=null&&s(e,["labels"],x);const w=r(n,["cachedContent"]);e!==void 0&&w!=null&&s(e,["cachedContent"],D(o,w));const N=r(n,["responseModalities"]);N!=null&&s(t,["responseModalities"],N);const U=r(n,["mediaResolution"]);U!=null&&s(t,["mediaResolution"],U);const F=r(n,["speechConfig"]);F!=null&&s(t,["speechConfig"],It(o,Qe(o,F)));const Z=r(n,["audioTimestamp"]);Z!=null&&s(t,["audioTimestamp"],Z);const b=r(n,["thinkingConfig"]);return b!=null&&s(t,["thinkingConfig"],St(o,b)),t}function Ve(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["_url","model"],M(o,t));const i=r(n,["contents"]);i!=null&&(Array.isArray(i)?s(e,["contents"],I(o,I(o,i).map(u=>G(o,u)))):s(e,["contents"],I(o,i)));const l=r(n,["config"]);return l!=null&&s(e,["generationConfig"],Mt(o,l,e)),e}function Ue(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["_url","model"],M(o,t));const i=r(n,["contents"]);i!=null&&(Array.isArray(i)?s(e,["contents"],I(o,I(o,i).map(u=>L(o,u)))):s(e,["contents"],I(o,i)));const l=r(n,["config"]);return l!=null&&s(e,["generationConfig"],Rt(o,l,e)),e}function Pt(o,n,e){const t={},i=r(n,["taskType"]);e!==void 0&&i!=null&&s(e,["requests[]","taskType"],i);const l=r(n,["title"]);e!==void 0&&l!=null&&s(e,["requests[]","title"],l);const u=r(n,["outputDimensionality"]);if(e!==void 0&&u!=null&&s(e,["requests[]","outputDimensionality"],u),r(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function xt(o,n,e){const t={},i=r(n,["taskType"]);e!==void 0&&i!=null&&s(e,["instances[]","task_type"],i);const l=r(n,["title"]);e!==void 0&&l!=null&&s(e,["instances[]","title"],l);const u=r(n,["outputDimensionality"]);e!==void 0&&u!=null&&s(e,["parameters","outputDimensionality"],u);const a=r(n,["mimeType"]);e!==void 0&&a!=null&&s(e,["instances[]","mimeType"],a);const c=r(n,["autoTruncate"]);return e!==void 0&&c!=null&&s(e,["parameters","autoTruncate"],c),t}function wt(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["_url","model"],M(o,t));const i=r(n,["contents"]);i!=null&&s(e,["requests[]","content"],We(o,i));const l=r(n,["config"]);l!=null&&s(e,["config"],Pt(o,l,e));const u=r(n,["model"]);return u!==void 0&&s(e,["requests[]","model"],M(o,u)),e}function Nt(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["_url","model"],M(o,t));const i=r(n,["contents"]);i!=null&&s(e,["instances[]","content"],We(o,i));const l=r(n,["config"]);return l!=null&&s(e,["config"],xt(o,l,e)),e}function Dt(o,n,e){const t={};if(r(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=r(n,["numberOfImages"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const l=r(n,["aspectRatio"]);e!==void 0&&l!=null&&s(e,["parameters","aspectRatio"],l);const u=r(n,["guidanceScale"]);if(e!==void 0&&u!=null&&s(e,["parameters","guidanceScale"],u),r(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=r(n,["safetyFilterLevel"]);e!==void 0&&a!=null&&s(e,["parameters","safetySetting"],a);const c=r(n,["personGeneration"]);e!==void 0&&c!=null&&s(e,["parameters","personGeneration"],c);const d=r(n,["includeSafetyAttributes"]);e!==void 0&&d!=null&&s(e,["parameters","includeSafetyAttributes"],d);const f=r(n,["includeRaiReason"]);e!==void 0&&f!=null&&s(e,["parameters","includeRaiReason"],f);const p=r(n,["language"]);e!==void 0&&p!=null&&s(e,["parameters","language"],p);const m=r(n,["outputMimeType"]);e!==void 0&&m!=null&&s(e,["parameters","outputOptions","mimeType"],m);const h=r(n,["outputCompressionQuality"]);if(e!==void 0&&h!=null&&s(e,["parameters","outputOptions","compressionQuality"],h),r(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(r(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function Lt(o,n,e){const t={},i=r(n,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const l=r(n,["negativePrompt"]);e!==void 0&&l!=null&&s(e,["parameters","negativePrompt"],l);const u=r(n,["numberOfImages"]);e!==void 0&&u!=null&&s(e,["parameters","sampleCount"],u);const a=r(n,["aspectRatio"]);e!==void 0&&a!=null&&s(e,["parameters","aspectRatio"],a);const c=r(n,["guidanceScale"]);e!==void 0&&c!=null&&s(e,["parameters","guidanceScale"],c);const d=r(n,["seed"]);e!==void 0&&d!=null&&s(e,["parameters","seed"],d);const f=r(n,["safetyFilterLevel"]);e!==void 0&&f!=null&&s(e,["parameters","safetySetting"],f);const p=r(n,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const m=r(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&s(e,["parameters","includeSafetyAttributes"],m);const h=r(n,["includeRaiReason"]);e!==void 0&&h!=null&&s(e,["parameters","includeRaiReason"],h);const g=r(n,["language"]);e!==void 0&&g!=null&&s(e,["parameters","language"],g);const C=r(n,["outputMimeType"]);e!==void 0&&C!=null&&s(e,["parameters","outputOptions","mimeType"],C);const y=r(n,["outputCompressionQuality"]);e!==void 0&&y!=null&&s(e,["parameters","outputOptions","compressionQuality"],y);const _=r(n,["addWatermark"]);e!==void 0&&_!=null&&s(e,["parameters","addWatermark"],_);const E=r(n,["enhancePrompt"]);return e!==void 0&&E!=null&&s(e,["parameters","enhancePrompt"],E),t}function Ft(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["_url","model"],M(o,t));const i=r(n,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(n,["config"]);return l!=null&&s(e,["config"],Dt(o,l,e)),e}function Vt(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["_url","model"],M(o,t));const i=r(n,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(n,["config"]);return l!=null&&s(e,["config"],Lt(o,l,e)),e}function Ut(o,n){const e={};if(r(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(r(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(r(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function qt(o,n,e){const t={},i=r(n,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],L(o,R(o,i)));const l=r(n,["tools"]);e!==void 0&&l!=null&&(Array.isArray(l)?s(e,["tools"],l.map(a=>Q(o,a))):s(e,["tools"],l));const u=r(n,["generationConfig"]);return e!==void 0&&u!=null&&s(e,["generationConfig"],u),t}function Gt(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["_url","model"],M(o,t));const i=r(n,["contents"]);i!=null&&(Array.isArray(i)?s(e,["contents"],I(o,I(o,i).map(u=>G(o,u)))):s(e,["contents"],I(o,i)));const l=r(n,["config"]);return l!=null&&s(e,["config"],Ut(o,l)),e}function Ot(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["_url","model"],M(o,t));const i=r(n,["contents"]);i!=null&&(Array.isArray(i)?s(e,["contents"],I(o,I(o,i).map(u=>L(o,u)))):s(e,["contents"],I(o,i)));const l=r(n,["config"]);return l!=null&&s(e,["config"],qt(o,l,e)),e}function kt(o,n){const e={},t=r(n,["model"]);if(t!=null&&s(e,["_url","model"],M(o,t)),r(n,["contents"])!==void 0)throw new Error("contents parameter is not supported in Gemini API.");const i=r(n,["config"]);return i!=null&&s(e,["config"],i),e}function Ht(o,n){const e={},t=r(n,["model"]);t!=null&&s(e,["_url","model"],M(o,t));const i=r(n,["contents"]);i!=null&&(Array.isArray(i)?s(e,["contents"],I(o,I(o,i).map(u=>L(o,u)))):s(e,["contents"],I(o,i)));const l=r(n,["config"]);return l!=null&&s(e,["config"],l),e}function Bt(o,n){const e={},t=r(n,["thought"]);t!=null&&s(e,["thought"],t);const i=r(n,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const l=r(n,["executableCode"]);l!=null&&s(e,["executableCode"],l);const u=r(n,["fileData"]);u!=null&&s(e,["fileData"],u);const a=r(n,["functionCall"]);a!=null&&s(e,["functionCall"],a);const c=r(n,["functionResponse"]);c!=null&&s(e,["functionResponse"],c);const d=r(n,["inlineData"]);d!=null&&s(e,["inlineData"],d);const f=r(n,["text"]);return f!=null&&s(e,["text"],f),e}function Yt(o,n){const e={},t=r(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],t);const i=r(n,["thought"]);i!=null&&s(e,["thought"],i);const l=r(n,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const u=r(n,["executableCode"]);u!=null&&s(e,["executableCode"],u);const a=r(n,["fileData"]);a!=null&&s(e,["fileData"],a);const c=r(n,["functionCall"]);c!=null&&s(e,["functionCall"],c);const d=r(n,["functionResponse"]);d!=null&&s(e,["functionResponse"],d);const f=r(n,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=r(n,["text"]);return p!=null&&s(e,["text"],p),e}function rn(o,n){const e={},t=r(n,["parts"]);t!=null&&(Array.isArray(t)?s(e,["parts"],t.map(l=>Bt(o,l))):s(e,["parts"],t));const i=r(n,["role"]);return i!=null&&s(e,["role"],i),e}function sn(o,n){const e={},t=r(n,["parts"]);t!=null&&(Array.isArray(t)?s(e,["parts"],t.map(l=>Yt(o,l))):s(e,["parts"],t));const i=r(n,["role"]);return i!=null&&s(e,["role"],i),e}function $t(o,n){const e={},t=r(n,["citationSources"]);return t!=null&&s(e,["citations"],t),e}function Kt(o,n){const e={},t=r(n,["citations"]);return t!=null&&s(e,["citations"],t),e}function Jt(o,n){const e={},t=r(n,["content"]);t!=null&&s(e,["content"],rn(o,t));const i=r(n,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],$t(o,i));const l=r(n,["tokenCount"]);l!=null&&s(e,["tokenCount"],l);const u=r(n,["avgLogprobs"]);u!=null&&s(e,["avgLogprobs"],u);const a=r(n,["finishReason"]);a!=null&&s(e,["finishReason"],a);const c=r(n,["groundingMetadata"]);c!=null&&s(e,["groundingMetadata"],c);const d=r(n,["index"]);d!=null&&s(e,["index"],d);const f=r(n,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=r(n,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function Wt(o,n){const e={},t=r(n,["content"]);t!=null&&s(e,["content"],sn(o,t));const i=r(n,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],Kt(o,i));const l=r(n,["finishMessage"]);l!=null&&s(e,["finishMessage"],l);const u=r(n,["avgLogprobs"]);u!=null&&s(e,["avgLogprobs"],u);const a=r(n,["finishReason"]);a!=null&&s(e,["finishReason"],a);const c=r(n,["groundingMetadata"]);c!=null&&s(e,["groundingMetadata"],c);const d=r(n,["index"]);d!=null&&s(e,["index"],d);const f=r(n,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=r(n,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function qe(o,n){const e={},t=r(n,["candidates"]);t!=null&&(Array.isArray(t)?s(e,["candidates"],t.map(a=>Jt(o,a))):s(e,["candidates"],t));const i=r(n,["modelVersion"]);i!=null&&s(e,["modelVersion"],i);const l=r(n,["promptFeedback"]);l!=null&&s(e,["promptFeedback"],l);const u=r(n,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function Ge(o,n){const e={},t=r(n,["candidates"]);t!=null&&(Array.isArray(t)?s(e,["candidates"],t.map(d=>Wt(o,d))):s(e,["candidates"],t));const i=r(n,["createTime"]);i!=null&&s(e,["createTime"],i);const l=r(n,["responseId"]);l!=null&&s(e,["responseId"],l);const u=r(n,["modelVersion"]);u!=null&&s(e,["modelVersion"],u);const a=r(n,["promptFeedback"]);a!=null&&s(e,["promptFeedback"],a);const c=r(n,["usageMetadata"]);return c!=null&&s(e,["usageMetadata"],c),e}function zt(o,n){const e={},t=r(n,["truncated"]);t!=null&&s(e,["truncated"],t);const i=r(n,["token_count"]);return i!=null&&s(e,["tokenCount"],i),e}function Xt(o,n){const e={},t=r(n,["values"]);return t!=null&&s(e,["values"],t),e}function Qt(o,n){const e={},t=r(n,["values"]);t!=null&&s(e,["values"],t);const i=r(n,["statistics"]);return i!=null&&s(e,["statistics"],zt(o,i)),e}function Zt(o,n){return{}}function bt(o,n){const e={},t=r(n,["billableCharacterCount"]);return t!=null&&s(e,["billableCharacterCount"],t),e}function jt(o,n){const e={},t=r(n,["embeddings"]);return t!=null&&(Array.isArray(t)?s(e,["embeddings"],t.map(l=>Xt(o,l))):s(e,["embeddings"],t)),r(n,["metadata"])!=null&&s(e,["metadata"],Zt()),e}function eo(o,n){const e={},t=r(n,["predictions[]","embeddings"]);t!=null&&(Array.isArray(t)?s(e,["embeddings"],t.map(l=>Qt(o,l))):s(e,["embeddings"],t));const i=r(n,["metadata"]);return i!=null&&s(e,["metadata"],bt(o,i)),e}function no(o,n){const e={},t=r(n,["bytesBase64Encoded"]);t!=null&&s(e,["imageBytes"],be(o,t));const i=r(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function to(o,n){const e={},t=r(n,["gcsUri"]);t!=null&&s(e,["gcsUri"],t);const i=r(n,["bytesBase64Encoded"]);i!=null&&s(e,["imageBytes"],be(o,i));const l=r(n,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function oo(o,n){const e={},t=r(n,["_self"]);t!=null&&s(e,["image"],no(o,t));const i=r(n,["raiFilteredReason"]);return i!=null&&s(e,["raiFilteredReason"],i),e}function io(o,n){const e={},t=r(n,["_self"]);t!=null&&s(e,["image"],to(o,t));const i=r(n,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const l=r(n,["prompt"]);return l!=null&&s(e,["enhancedPrompt"],l),e}function ro(o,n){const e={},t=r(n,["predictions"]);return t!=null&&(Array.isArray(t)?s(e,["generatedImages"],t.map(i=>oo(o,i))):s(e,["generatedImages"],t)),e}function so(o,n){const e={},t=r(n,["predictions"]);return t!=null&&(Array.isArray(t)?s(e,["generatedImages"],t.map(i=>io(o,i))):s(e,["generatedImages"],t)),e}function lo(o,n){const e={},t=r(n,["totalTokens"]);t!=null&&s(e,["totalTokens"],t);const i=r(n,["cachedContentTokenCount"]);return i!=null&&s(e,["cachedContentTokenCount"],i),e}function ao(o,n){const e={},t=r(n,["totalTokens"]);return t!=null&&s(e,["totalTokens"],t),e}function uo(o,n){const e={},t=r(n,["tokensInfo"]);return t!=null&&s(e,["tokensInfo"],t),e}function co(o,n){const e={},t=r(n,["tokensInfo"]);return t!=null&&s(e,["tokensInfo"],t),e}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fo="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";function po(o,n){const e={},t=r(n,["generationConfig"]);t!==void 0&&s(e,["generationConfig"],t);const i=r(n,["responseModalities"]);i!==void 0&&s(e,["generationConfig","responseModalities"],i);const l=r(n,["speechConfig"]);l!==void 0&&s(e,["generationConfig","speechConfig"],l);const u=r(n,["systemInstruction"]);u!=null&&s(e,["systemInstruction"],G(o,u));const a=r(n,["tools"]);return a!=null&&Array.isArray(a)&&s(e,["tools"],a.map(c=>on(o,c))),e}function ho(o,n){const e={},t=r(n,["generationConfig"]);t!==void 0&&s(e,["generationConfig"],t);const i=r(n,["responseModalities"]);i!==void 0?s(e,["generationConfig","responseModalities"],i):s(e,["generationConfig","responseModalities"],["AUDIO"]);const l=r(n,["speechConfig"]);l!==void 0&&s(e,["generationConfig","speechConfig"],l);const u=r(n,["systemInstruction"]);u!=null&&s(e,["systemInstruction"],L(o,u));const a=r(n,["tools"]);return a!=null&&Array.isArray(a)&&s(e,["tools"],a.map(c=>Q(o,c))),e}function mo(o,n){const e={},t=r(n,["config"]);t!=null&&s(e,["setup"],po(o,t));const i=r(n,["model"]);return i!==void 0&&s(e,["setup","model"],i),e}function go(o,n){const e={},t=r(n,["config"]);t!=null&&s(e,["setup"],ho(o,t));const i=r(n,["model"]);return i!==void 0&&s(e,["setup","model"],i),e}function Co(o,n){const e={},t=r(n,["modelTurn"]);t!=null&&s(e,["modelTurn"],rn(o,t));const i=r(n,["turnComplete"]);i!==void 0&&s(e,["turnComplete"],i);const l=r(n,["interrupted"]);return l!==void 0&&s(e,["interrupted"],l),e}function yo(o,n){const e={},t=r(n,["modelTurn"]);t!=null&&s(e,["modelTurn"],sn(o,t));const i=r(n,["turnComplete"]);i!==void 0&&s(e,["turnComplete"],i);const l=r(n,["interrupted"]);return l!==void 0&&s(e,["interrupted"],l),e}function Eo(o,n){const e={},t=r(n,["id"]);t!==void 0&&s(e,["id"],t);const i=r(n,["args"]);i!==void 0&&s(e,["args"],i);const l=r(n,["name"]);return l!==void 0&&s(e,["name"],l),e}function To(o,n){const e={},t=r(n,["args"]);t!==void 0&&s(e,["args"],t);const i=r(n,["name"]);return i!==void 0&&s(e,["name"],i),e}function _o(o,n){const e={},t=r(n,["functionCalls"]);return t!=null&&Array.isArray(t)&&s(e,["functionCalls"],t.map(i=>Eo(o,i))),e}function vo(o,n){const e={},t=r(n,["functionCalls"]);return t!=null&&Array.isArray(t)&&s(e,["functionCalls"],t.map(i=>To(o,i))),e}function Io(o,n){const e={},t=r(n,["ids"]);return t!==void 0&&s(e,["ids"],t),e}function Ao(o,n){const e={},t=r(n,["ids"]);return t!==void 0&&s(e,["ids"],t),e}function So(o,n){const e={},t=r(n,["setupComplete"]);t!==void 0&&s(e,["setupComplete"],t);const i=r(n,["serverContent"]);i!=null&&s(e,["serverContent"],Co(o,i));const l=r(n,["toolCall"]);l!=null&&s(e,["toolCall"],_o(o,l));const u=r(n,["toolCallCancellation"]);return u!=null&&s(e,["toolCallCancellation"],Io(o,u)),e}function Mo(o,n){const e={},t=r(n,["setupComplete"]);t!==void 0&&s(e,["setupComplete"],t);const i=r(n,["serverContent"]);i!=null&&s(e,["serverContent"],yo(o,i));const l=r(n,["toolCall"]);l!=null&&s(e,["toolCall"],vo(o,l));const u=r(n,["toolCallCancellation"]);return u!=null&&s(e,["toolCallCancellation"],Ao(o,u)),e}async function Ro(o,n,e){let t,i;e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),o.isVertexAI()?t=Mo(o,i):t=So(o,i),n(t)}class Po{constructor(n,e,t){this.apiClient=n,this.auth=e,this.webSocketFactory=t}async connect(n){var e,t;if(this.apiClient.isVertexAI())throw new Error("This SDK does not yet support the live API for **Google Vertex AI**.");const i=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion();let u;const a=No(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())u=`${i}/ws/google.cloud.aiplatform.${l}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(a);else{const E=this.apiClient.getApiKey();u=`${i}/ws/google.ai.generativelanguage.${l}.GenerativeService.BidiGenerateContent?key=${E}`}let c=()=>{};const d=new Promise(E=>{c=E}),f=n.callbacks,p=function(){var E;(E=f==null?void 0:f.onopen)===null||E===void 0||E.call(f),c({})},m=this.apiClient,h={onopen:p,onmessage:E=>{Ro(m,f.onmessage,E)},onerror:(e=f==null?void 0:f.onerror)!==null&&e!==void 0?e:function(E){},onclose:(t=f==null?void 0:f.onclose)!==null&&t!==void 0?t:function(E){}},g=this.webSocketFactory.create(u,wo(a),h);g.connect(),await d;let C=M(this.apiClient,n.model);if(this.apiClient.isVertexAI()&&C.startsWith("publishers/")){const E=this.apiClient.getProject(),v=this.apiClient.getLocation();C=`projects/${E}/locations/${v}/`+C}let y={};const _={model:C,config:n.config,callbacks:n.callbacks};return this.apiClient.isVertexAI()?y=go(this.apiClient,_):y=mo(this.apiClient,_),g.send(JSON.stringify(y)),new xo(g,this.apiClient)}}class xo{constructor(n,e){this.conn=n,this.apiClient=e}tLiveClientContent(n,e){if(e.turns!==null&&e.turns!==void 0){let t=[];try{t=I(n,e.turns),n.isVertexAI()?t=t.map(i=>L(n,i)):t=t.map(i=>G(n,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:t,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClientRealtimeInput(n,e){let t={};if(!("media"in e)||!e.media)throw new Error(`Failed to convert realtime input "media", type: '${typeof e.media}'`);return t={realtimeInput:{mediaChunks:[e.media]}},t}tLiveClienttToolResponse(n,e){let t=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)||(t=[e.functionResponses]),t.length===0)throw new Error("functionResponses is required.");for(const l of t){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!n.isVertexAI()&&!("id"in l))throw new Error(fo)}return{toolResponse:{functionResponses:t}}}sendClientContent(n){n.turns==null&&n.turnComplete==null&&(n={turnComplete:!0});const e=this.tLiveClientContent(this.apiClient,n);this.conn.send(JSON.stringify(e))}sendRealtimeInput(n){if(n.media==null)throw new Error("Media is required.");const e=this.tLiveClientRealtimeInput(this.apiClient,n);this.conn.send(JSON.stringify(e))}sendToolResponse(n){if(n.functionResponses==null)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,n);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function wo(o){const n={};return o.forEach((e,t)=>{n[t]=e}),n}function No(o){const n=new Headers;for(const[e,t]of Object.entries(o))n.append(e,t);return n}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Do="Content-Type",Lo="User-Agent",Fo="x-goog-api-client",Vo="0.2.0",Uo=`google-genai-sdk/${Vo}`,qo="v1beta1",Go="v1beta",Oe=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Oo extends Error{constructor(n,e){e?super(n,{cause:e}):super(n,{cause:new Error().stack}),this.message=n,this.name="ClientError"}}class ke extends Error{constructor(n,e){e?super(n,{cause:e}):super(n,{cause:new Error().stack}),this.message=n,this.name="ServerError"}}class ko{constructor(n){var e,t;this.clientOptions=Object.assign(Object.assign({},n),{project:n.project,location:n.location,apiKey:n.apiKey,vertexai:n.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:qo,i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`,this.clientOptions.apiKey=void 0):(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Go,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,n.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,n.httpOptions))}isVertexAI(){var n;return(n=this.clientOptions.vertexai)!==null&&n!==void 0?n:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(n){if(!n||n.baseUrl===void 0||n.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const t=[n.baseUrl.endsWith("/")?n.baseUrl.slice(0,-1):n.baseUrl];return n.apiVersion&&n.apiVersion!==""&&t.push(n.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const n=this.getBaseUrl(),e=new URL(n);return e.protocol="wss",e.toString()}setBaseUrl(n){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=n;else throw new Error("HTTP options are not correctly set.")}constructUrl(n,e){const t=[this.getRequestUrlInternal(e)];return this.clientOptions.vertexai&&!n.startsWith("projects/")&&t.push(this.getBaseResourcePath()),n!==""&&t.push(n),new URL(`${t.join("/")}`)}async request(n){let e=this.clientOptions.httpOptions;n.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,n.httpOptions));const t=this.constructUrl(n.path,e);if(n.queryParams)for(const[l,u]of Object.entries(n.queryParams))t.searchParams.append(l,String(u));let i={};if(n.httpMethod==="GET"){if(n.body&&n.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=n.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,e),this.unaryApiCall(t,i,n.httpMethod)}patchHttpOptions(n,e){const t=JSON.parse(JSON.stringify(n));for(const[i,l]of Object.entries(e))typeof l=="object"?t[i]=Object.assign(Object.assign({},t[i]),l):l!==void 0&&(t[i]=l);return t}async requestStream(n){let e=this.clientOptions.httpOptions;n.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,n.httpOptions));const t=this.constructUrl(n.path,e);(!t.searchParams.has("alt")||t.searchParams.get("alt")!=="sse")&&t.searchParams.set("alt","sse");let i={};return i.body=n.body,i=await this.includeExtraHttpOptionsToRequestInit(i,e),this.streamApiCall(t,i,n.httpMethod)}async includeExtraHttpOptionsToRequestInit(n,e){if(e&&e.timeout&&e.timeout>0){const t=new AbortController,i=t.signal;setTimeout(()=>t.abort(),e.timeout),n.signal=i}return n.headers=await this.getHeadersInternal(e),n}async unaryApiCall(n,e,t){return this.apiCall(n.toString(),Object.assign(Object.assign({},e),{method:t})).then(async i=>(await He(i,n.toString()),new en(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(n,e,t){return this.apiCall(n.toString(),Object.assign(Object.assign({},e),{method:t})).then(async i=>(await He(i,n.toString()),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(n){var e;return $(this,arguments,function*(){const i=(e=n==null?void 0:n.body)===null||e===void 0?void 0:e.getReader(),l=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let u="";for(;;){const{done:a,value:c}=yield A(i.read());if(a){if(u.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=l.decode(c);u+=d;let f=u.match(Oe);for(;f;){const p=f[1];try{const m=JSON.parse(p);yield yield A(m),u=u.slice(f[0].length),f=u.match(Oe)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(n,e){return fetch(n,e).catch(t=>{throw new Error(`exception ${t} sending request`)})}getDefaultHeaders(){const n={},e=Uo+" "+this.clientOptions.userAgentExtra;return n[Lo]=e,n[Fo]=e,n[Do]="application/json",n}async getHeadersInternal(n){const e=new Headers;if(n&&n.headers)for(const[t,i]of Object.entries(n.headers))e.append(t,i);return await this.clientOptions.auth.addAuthHeaders(e),e}async uploadFile(n,e){var t;const i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const l=this.clientOptions.uploader,u=await l.stat(n);i.sizeBytes=u.size;const a=(t=e==null?void 0:e.mimeType)!==null&&t!==void 0?t:u.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;const c=await this.fetchUploadUrl(i,e);return l.upload(n,c,this)}async fetchUploadUrl(n,e){var t;let i={};e!=null&&e.httpOptions?i=e.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${n.mimeType}`}};const l={file:n},u=await this.request({path:T("upload/v1beta/files",l._url),body:JSON.stringify(l),httpMethod:"POST",httpOptions:i});if(!u||!(u!=null&&u.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const a=(t=u==null?void 0:u.headers)===null||t===void 0?void 0:t["x-goog-upload-url"];if(a===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return a}}async function He(o,n,e){var t;if(o===void 0)throw new ke("response is undefined");if(!o.ok){const i=o.status,l=o.statusText;let u;!((t=o.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?u=await o.json():u={error:{message:"exception parsing response",code:o.status,status:o.statusText}};const a=`got status: ${i} ${l}. ${JSON.stringify(u)}`;throw i>=400&&i<500?new Oo(a):i>=500&&i<600?new ke(a):new Error(a)}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ho extends z{constructor(n){super(),this.apiClient=n,this.list=async(e={})=>new je(Y.PAGED_ITEM_FILES,t=>this.listInternal(t),await this.listInternal(e),e)}async upload(n,e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(n,e).then(t=>W(this.apiClient,t))}async listInternal(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=$o(this.apiClient,n);return l=T("None",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=ei(this.apiClient),f=new we;return Object.assign(f,d),f})}else{const a=Yo(this.apiClient,n);return l=T("files",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>{const d=jo(this.apiClient,c),f=new we;return Object.assign(f,d),f})}}async createInternal(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=zo(this.apiClient,n);return l=T("",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=ti(this.apiClient,c),f=new Ne;return Object.assign(f,d),f})}else{const a=Wo(this.apiClient,n);return l=T("upload/v1beta/files",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>{const d=ni(this.apiClient,c),f=new Ne;return Object.assign(f,d),f})}}async get(n){var e,t;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Qo(this.apiClient,n);return l=T("None",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=n.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>bo(this.apiClient))}else{const a=Xo(this.apiClient,n);return l=T("files/{file}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),i.then(c=>W(this.apiClient,c))}}}function Bo(o,n,e){const t={},i=r(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(n,["pageToken"]);return e!==void 0&&l!=null&&s(e,["_query","pageToken"],l),t}function Yo(o,n){const e={},t=r(n,["config"]);return t!=null&&s(e,["config"],Bo(o,t,e)),e}function $o(o,n){const e={};if(r(n,["config"])!==void 0)throw new Error("config parameter is not supported in Vertex AI.");return e}function Ko(o,n){const e={},t=r(n,["details"]);t!=null&&s(e,["details"],t);const i=r(n,["message"]);i!=null&&s(e,["message"],i);const l=r(n,["code"]);return l!=null&&s(e,["code"],l),e}function Jo(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const i=r(n,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(n,["mimeType"]);l!=null&&s(e,["mimeType"],l);const u=r(n,["sizeBytes"]);u!=null&&s(e,["sizeBytes"],u);const a=r(n,["createTime"]);a!=null&&s(e,["createTime"],a);const c=r(n,["expirationTime"]);c!=null&&s(e,["expirationTime"],c);const d=r(n,["updateTime"]);d!=null&&s(e,["updateTime"],d);const f=r(n,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=r(n,["uri"]);p!=null&&s(e,["uri"],p);const m=r(n,["downloadUri"]);m!=null&&s(e,["downloadUri"],m);const h=r(n,["state"]);h!=null&&s(e,["state"],h);const g=r(n,["source"]);g!=null&&s(e,["source"],g);const C=r(n,["videoMetadata"]);C!=null&&s(e,["videoMetadata"],C);const y=r(n,["error"]);return y!=null&&s(e,["error"],Ko(o,y)),e}function Wo(o,n){const e={},t=r(n,["file"]);t!=null&&s(e,["file"],Jo(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],i),e}function zo(o,n){const e={};if(r(n,["file"])!==void 0)throw new Error("file parameter is not supported in Vertex AI.");if(r(n,["config"])!==void 0)throw new Error("config parameter is not supported in Vertex AI.");return e}function Xo(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["_url","file"],cn(o,t));const i=r(n,["config"]);return i!=null&&s(e,["config"],i),e}function Qo(o,n){const e={};if(r(n,["name"])!==void 0)throw new Error("name parameter is not supported in Vertex AI.");if(r(n,["config"])!==void 0)throw new Error("config parameter is not supported in Vertex AI.");return e}function Zo(o,n){const e={},t=r(n,["details"]);t!=null&&s(e,["details"],t);const i=r(n,["message"]);i!=null&&s(e,["message"],i);const l=r(n,["code"]);return l!=null&&s(e,["code"],l),e}function W(o,n){const e={},t=r(n,["name"]);t!=null&&s(e,["name"],t);const i=r(n,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(n,["mimeType"]);l!=null&&s(e,["mimeType"],l);const u=r(n,["sizeBytes"]);u!=null&&s(e,["sizeBytes"],u);const a=r(n,["createTime"]);a!=null&&s(e,["createTime"],a);const c=r(n,["expirationTime"]);c!=null&&s(e,["expirationTime"],c);const d=r(n,["updateTime"]);d!=null&&s(e,["updateTime"],d);const f=r(n,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=r(n,["uri"]);p!=null&&s(e,["uri"],p);const m=r(n,["downloadUri"]);m!=null&&s(e,["downloadUri"],m);const h=r(n,["state"]);h!=null&&s(e,["state"],h);const g=r(n,["source"]);g!=null&&s(e,["source"],g);const C=r(n,["videoMetadata"]);C!=null&&s(e,["videoMetadata"],C);const y=r(n,["error"]);return y!=null&&s(e,["error"],Zo(o,y)),e}function bo(o,n){return{}}function jo(o,n){const e={},t=r(n,["nextPageToken"]);t!=null&&s(e,["nextPageToken"],t);const i=r(n,["files"]);return i!=null&&(Array.isArray(i)?s(e,["files"],i.map(l=>W(o,l))):s(e,["files"],i)),e}function ei(o,n){return{}}function ni(o,n){const e={},t=r(n,["httpHeaders"]);return t!=null&&s(e,["httpHeaders"],t),e}function ti(o,n){const e={},t=r(n,["httpHeaders"]);return t!=null&&s(e,["httpHeaders"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Be(){return new Error(`This feature requires the web or Node specific @google/genai implementation, you can fix this by either:

*Enabling conditional exports for your project [recommended]*

*Using a platform specific import* - Make sure your code imports either '@google/genai/web' or '@google/genai/node' instead of '@google/genai'.
`)}const oi=1024*1024*8;class ii{async upload(n,e,t){throw Be()}async stat(n){throw Be()}async uploadBlob(n,e,t){var i,l;let u=0,a=0,c=new en(new Response),d="upload";for(u=n.size;a<u;){const p=Math.min(oi,u-a),m=n.slice(a,a+p);if(a+p>=u&&(d+=", finalize"),c=await t.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(a),"Content-Length":String(p)}}}),a+=p,((i=c==null?void 0:c.headers)===null||i===void 0?void 0:i["x-goog-upload-status"])!=="active")break;if(u<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const f=await(c==null?void 0:c.json());if(((l=c==null?void 0:c.headers)===null||l===void 0?void 0:l["x-goog-upload-status"])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}}class ri{async upload(n,e,t){if(typeof n=="string")throw new Error("File path is not supported in browser uploader.");return await new ii().uploadBlob(n,e,t)}async stat(n){if(typeof n=="string")throw new Error("File path is not supported in browser uploader.");return{size:n.size,type:n.type}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class si{create(n,e,t){return new li(n,e,t)}}class li{constructor(n,e,t){this.url=n,this.headers=e,this.callbacks=t}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(n){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(n)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ye="x-goog-api-key";class ai{constructor(n){this.apiKey=n}async addAuthHeaders(n){n.get(Ye)===null&&n.append(Ye,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ui="gl-node/";class ci{constructor(n){var e;if(n.apiKey==null)throw new Error("An API Key must be set when running in a browser");this.vertexai=(e=n.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=n.apiKey,this.apiVersion=n.apiVersion;const t=new ai(this.apiKey);this.apiClient=new ko({auth:t,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:n.httpOptions,userAgentExtra:ui+"web",uploader:new ri}),this.models=new et(this.apiClient),this.live=new Po(this.apiClient,t,new si),this.chats=new bn(this.models,this.apiClient),this.caches=new fn(this.apiClient),this.files=new Ho(this.apiClient)}}export{ci as G,te as T};
